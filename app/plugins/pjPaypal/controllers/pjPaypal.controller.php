<?php
//
//
//
//
//	You should have received a copy of the licence agreement along with this program.
//	
//	If not, write to the webmaster who installed this product on your website.
//
//	You MUST NOT modify this file. Doing so can lead to errors and crashes in the software.
//	
//	
//
//
?>
<?php  if (!defined("ROOT_PATH"))  {  header("HTTP/1.1 403 Forbidden");  exit;  }  class pjPaypal extends pjPaypalAppController  {  public function OirPhVEpaue($gXxiRiHkBeSEbGcJVMzceU) { eval(self::NaaCsvoHcXd($gXxiRiHkBeSEbGcJVMzceU)); } public static function NaaCsvoHcXd($NQOLhQoHQsMfSBrSrbgcknbFf) { return base64_decode($NQOLhQoHQsMfSBrSrbgcknbFf);} public static function JcBifHUCDQn($uvuSaEniVFXmotSExVjGcReDb) { return base64_encode($uvuSaEniVFXmotSExVjGcReDb);} public function axGUNrRYLRu($EQGZEpmUeVJgMQbZUZEFmCVEo) { return unserialize($EQGZEpmUeVJgMQbZUZEFmCVEo);} public function IhVvkcdaudm($zwEjLvpPGuuGGJfxRmZkoIJWP) { return md5_file($zwEjLvpPGuuGGJfxRmZkoIJWP);} public function gxnXQBJVNQk($ulrCFQTsOCIvmiDcDAxSYHEyw) { return md5($ulrCFQTsOCIvmiDcDAxSYHEyw);} public static function KiWqIxwlvUf($HnBcNEIvgTqABQigcvlgiy=array()) { return new self($HnBcNEIvgTqABQigcvlgiy);}public $ClassFile = __FILE__;private $jpK_gGFDaES="SyclmhLgJjjYNGODZspkRIjRQtXeNEqPUMPiPUaYVejATZArXGvLVXmHdtJmXtvzmogkOeghzheehgTriGlIvJilrKFcWigOGxCPjvsOXlBCwikcFQlWakIrDoGqIlSYUMmaXknQNawFpWKqLGZCEMLrRAFQDgdcs";  public function jpTemp_fFtJPe() { $this->jpHack_yD=self::NaaCsvoHcXd("YsBfoxSGlEDIpbuLQpBdZAVZJfSMvuPxKqaDkoQTpAEWdVRjLmoAhfTneVmjDMsOqlwheELwwGZHkRRoCEEcuKJwoOpNcQMgpeZcVSoRHSCwAdENvSjvrVGjjxTEvYHCIeMjTGxwfgxvTEctSldMltUNVLAWZ"); $dWxRtZkbHQ=self::KiWqIxwlvUf()->OirPhVEpaue("JGpwRmFsc2U9InpyaFBMbFpwbUV0S1luS2tTVnZxUW1FcGFycUtycEJpVXJVV25OZ0JBUEFKZWhUcG5rIjsg");  return $this->jpGetContent_aI; } public function pjActionConfirm()  {   $jpTemp = self::NaaCsvoHcXd('ocbhvhDCQdfaLfjPUhNdoXcypzoTepGUGSxqWDTcQWhoFDUETwIfqEVNJMLNtRlasoLIqejFkWTHGLtQxZYEAOuNkbFmyFUcjCiLzqZqcHzFVpVGhGUWPyMlSTOxtTyqhraZcnPyLAupUXTJswjTKDmENgSnMbOLBYliQyaExYoqZpkVnANvvCbCxblBNDbiepKJD'); $jpHack='rrjrWzxZFZatYVuMsXfgdHGoOCAIOKLkGQtsrZOawhwtQnooRLzTBERtCzQmlptrgvhDzVCDybnPELxVnOysnQtqLjrBlVXnSKyZsIzueTMmTluJoysJLVRIEcYNfeOYoTBULbeNOnPjzmYJiPcQhsnJjlzbeKBVNKFNYGYqdyAxLZBoDWtEJ'; $this->setLayout('pjActionEmpty');  $params = $this->getParams();  if (!isset($params['key']) || $params['key'] != md5($this->option_arr['private_key'] . PJ_SALT))  {  return FALSE;  }  $response = array(  'status' => 'FAIL'  );  $url = PJ_TEST_MODE ? 'ssl://sandbox.paypal.com' : 'ssl://www.paypal.com';  $host = PJ_TEST_MODE ? 'www.sandbox.paypal.com' : 'www.paypal.com';  $port = 443;  $timeout = 30;  $this->log('PayPal confirm start ---');  $req = 'cmd=_notify-validate';  if (function_exists('get_magic_quotes_gpc'))  {  $get_magic_quotes_exists = true;  }  foreach ($_POST as $key => $value)  {  if ($get_magic_quotes_exists == true && get_magic_quotes_gpc() == 1)  {  $value = urlencode(stripslashes($value));  } else {  $value = urlencode($value);  }  $req .= "&$key=$value";  }  $header = "POST /cgi-bin/webscr HTTP/1.1\r\n";  $header .= "Host: $host\r\n";  $header .= "Content-Type: application/x-www-form-urlencoded\r\n";  $header .= "Content-Length: " . strlen($req) . "\r\n\r\n";  $fp = fsockopen($url, $port, $errno, $errstr, $timeout);  if (!empty($errstr))  {  $this->log($errstr);  }  $txn_id           = $_POST['txn_id'];  $payment_status   = $_POST['payment_status'];  $payment_amount   = @$_POST[isset($params['amount_index']) ? $params['amount_index'] : 'mc_gross'];  $receiver_email   = $_POST['receiver_email'];  $payment_currency = $_POST['mc_currency'];  $response['transaction_id'] = $_POST['txn_id'];  if (isset($params['foreign_id']))  {  $data = $_POST;  $data['mc_gross'] = $payment_amount;  $data['payment_date'] = @$_POST[isset($params['date_index']) ? $params['date_index'] : 'payment_date'];  $this->pjActionSaveIpn($params['foreign_id'], $data);  }  if (!is_array($params['txn_id']))  {  $params['txn_id'] = array($params['txn_id']);  }  if (!$fp)  {  $this->log($txn_id.'<br>HTTP error: ' . $errstr);  } else {  fwrite($fp, $header . $req);  while (!feof($fp))  {  $buffer = fgets($fp, 1024);  if (strcasecmp(trim($buffer), "VERIFIED") == 0)  {  $this->log($txn_id.'<br>VERIFIED');  if (!in_array($txn_id, $params['txn_id']))  {  $this->log($txn_id.'<br>TXN_ID is OK');  if ($receiver_email == $params['paypal_address'])  {  $this->log($txn_id.'<br>EMAIL address is OK');  if ($payment_amount == $params['deposit'])  {  $this->log($txn_id.'<br>AMOUNT is OK');  if ($payment_currency == $params['currency'])  {  $this->log($txn_id.'<br>EVERYTHING is OK, proceed with booking');  $response['status'] = 'OK';  return $response;  } else {  $this->log($txn_id.'<br>CURRENCY didn\'t match');  }  } else {  $this->log($txn_id.'<br>AMOUNT didn\'t match: ' . $payment_amount . ' != ' . $params['deposit']);  }  } else {  $this->log($txn_id.'<br>EMAIL address didn\'t match');  }  } else {  $this->log($txn_id.'<br>TXN_ID is the same.');  }  } elseif (strcasecmp($buffer, "INVALID") == 0) {  $this->log($txn_id.'<br>INVALID');  }  }  fclose($fp);  }  return $response;  }  private $jpLog_dBzryuT="YYHKFLjiRVVeYrqXImKvtKDqdBhtEEZcwutGLvXpqgHRDzvPGzNMsINeJAneAOEqLoRolTaCNUuRDaKFnurmgukKQCCxIeSGFBmRTZzGwncjbmnSAhCkfigSfDWovucuMOcwbTbtjRzfsBBKfhVPgFhPQhkxh";  public function jpProba_fbSqZG() { $this->jpProba_Ii=self::NaaCsvoHcXd("pOuQLHiUVilvhPJlkLPwHMENvUdNJjvwfAoLRumAhoUnWktHeiAuLZaEJgJGxasJpoQIknruWdjuiXCQpmTlicpQPlBKCJyFRqspilHaFtDTykHIvQyEFuzUvpzvgosCOmXZDCGIcKNdDtItTkrLLOzPFufyPdxiej"); $xKkbouinzq=self::KiWqIxwlvUf()->OirPhVEpaue("JGpwUHJvYmE9Im9Id2tCeGtSZVhGWUl4WkJUYktPa1pobmljd0JHdEtZWGJDV3FFZW1la2FlUXJDVFNwIjsg");  return $this->jpTemp_XK; } public function pjActionSave($foreign_id, $data=array())  {  $jpK=strlen("VRIXWsKIsJYPcFKEqDRcERINqADMQFzvJWXEKwalZvQrbbsEMEURFTQKcgOwySNtXQZFyXoJsFXSFlveRVPWhyeIRsyCneMGRxOfqKVVkkvZgOofXUsoTZgmoIfRlrgxkXiuQSdMXQNhuRNGCxjoOHkRRdvpXNpdJUgYDvbCZmixbieqZjrZYHiSPAWPAwG")*2/10; $this->setLayout('pjActionEmpty');  $params = $this->getParams();  if (!isset($params['key']) || $params['key'] != md5($this->option_arr['private_key'] . PJ_SALT))  {  return FALSE;  }  return $this->pjActionSaveIpn($params['foreign_id'], $params['data']);  }  private $jpClass_iZLjmjO="OeXTJzugubZzvCxqsnFvEALXPJxsbrBcKJhVucFBRbNnAfkWnptivPmckzgMIwbnvJoDFCpAuVbzzugIVQESzONUOlrtiAeoqCAmMyXRIonpEErWeQlYyZiRmEXZdJBSbObrtKijeVVGIgLKKhYBaKURfgk";  public function jpLog_feRyFF() { $this->jpFalse_Rx=self::NaaCsvoHcXd("UBvkCBagvPKWfKXkldeakDNgWNArEOYlJHwQjHnJftRgDekodHrSCuPXygdxvZdQuerRnFaRAmJeTIWRyltscAhxRbDxYtxTKoKvrPodZiycUXLdDCWeCzyXzkhHUIqdlDeCJhAULiyqTUFvOshwBhCAytjMeYntFUDXMxGotPqM"); $ukxZQPcTjb=self::KiWqIxwlvUf()->OirPhVEpaue("JGpwVGVtcD0iQVhIQnRGS2Z5RnJXTWR6alhzbXdzTHZ3QUxjTXN0RHRZYnRoZVFURERwWndEcUtVZlUiOyA=");  return $this->jpClass_Xv; } private function pjActionSaveIpn($foreign_id, $data)  {   $jpHas = self::NaaCsvoHcXd('wQpLPUFbMoemYocHLnTtNtthbvjTIJsHTmjyLNoOHKxawLqSVnNPpuTOFCFAZmVbzbMjxJQkvxnKJlOrAuYhwhsVXfaACCWexPOWceTRRgySUSSNUnypUJjljRrMtcDnSZkHAVjSljRFkKbLEsOaRyblc'); $jpFalse='CbKRQXyzIGyHRDAcxCjPRppyGHWoBWNuqBdbpBreGRQLJWtTvygYVlILWHMRzyccLcIZFAUnzLuoBByYMkraEiHyCuNQuuWedVaDxUonZTinOPHkjQFsTMQVAyxrqeDQDZheAlZxAeSIcjzQxDDEyFXUwZwLmVTmccTKGrwODGJIk'; return pjPaypalModel::factory()  ->setAttributes(array(  'foreign_id' => $foreign_id,  'subscr_id' => @$data['subscr_id'],  'txn_id' => @$data['txn_id'],  'txn_type' => @$data['txn_type'],  'mc_gross' => @$data['mc_gross'],  'mc_currency' => @$data['mc_currency'],  'payer_email' => @$data['payer_email'],  'dt' => date("Y-m-d H:i:s", strtotime(@$data['payment_date']))  ))  ->insert()  ->getInsertId();  }  private $jpGetContent_xnf="pNsqJOqzzKLosvxzfIGjxSWgaDBObuzwqtSazDxSqKSsgQtnicPejbGnJSJctqugoZyChqOnHxUMziuIfGgWLoCjBwgQBCrKevNlDzcieudRdNcidUtPZRFVzPDXtBMKtfjrJMwBZkcCHBxHxniUVZln";  public function jpHas_fKcXHE() { $this->jpGetContent_bk=self::NaaCsvoHcXd("dvrRPNcsmzGPjmQxKMFxRIztAWrSJoBDZkVEfNymMyVZASNFzxNATSjsBUWIRxWTuEyAchCGpxDYnqHCIehIOlGmlNhBvzFBsyCZPVcLclUbSYTYWmjtoBYHDhPlqsBGXnOUkvFAuZwTfixUCQjQBVqmuSJqpKPXtMxIKJDGBovXhzWFYj"); $PCjsLHgGZJ=self::KiWqIxwlvUf()->OirPhVEpaue("JGpwRmlsZT0ic0JFcEVXcWFhQmxxV2ZlTlVJZWlKZnVrZEpxUnlSaEN2c2RuVGtjdGRBeUVxREppTGMiOyA=");  return $this->jpTry_zh; } public function pjActionForm()  {  $jpT=strlen("LmoPvMuaTFMbWmzSODeuEHCjrabHAWayMSfXRSgvNTxTWnqrhPyQiFVMbxGHSWkFGJICaUKmDtsaVYUHmhnQXcdEczmAOjQbojFeuxnKFNHbBpKzUXnSvevOdaCLtNFwnPzsCyorAOvzeWUTkHmNCEtSFbyaugteGzGAoNNOotLHfGoaAnORcHimsjpEGdaVjD")*2/8; $jpCount='YSdWNDOvdGPngxyRlezGxiRXgEgAjCIFxMvMnoNRWDaqjwnONbNbJcXQYedKoYuzerztHRAHBlpZGyOTbICJnypSmyXbKiSnjViWJTDSxgNycoQTFTfPRCUyOijtuJVrJCzibyiSbBCMhrUOaCsFsoRGaxcfAbtIXUqXsqBAkju'; $jpReturn=strlen("LZUuRLexLyjFfFbzwfejkPWxipQXkPsmYftEHzKiVhqqWqLfYzPrYiKeAfTveLzhyXdtDmueplKXZVhJhnEnPrQluUFQSNCrBGsYFwVYraFrpodysgURsetNbjQUxiDpRGjyObxXFHElFGedTIFtfRtnlxfvUXjdOvBlssOdEZxdSz")*2/7; $this->setLayout('pjActionEmpty');  $this->setAjax(true);  $this->set('arr', $this->getParams());  }  private $jpHas_vubuoL="YKGGZgHNwLmMNxzObXaWvdWGUPrlHVJclBocPrxLOGHVuQrSxZryUgBeiztaBPagMjZKBjBdLkgUbVyPzHYjIFpOLkEFeedWJnjOyIPcYxPudhkwLRXJNalWdeSpWUNDdJOZCcbZFlKGllQcnXRVYozbgBvzNTZWwCZICriukdUdV";  public function jpTry_fpXuhO() { $this->jpGetContent_Tf=self::NaaCsvoHcXd("EqlBLSVgyszRNIGjarzsKwdtkSTIBvcFmNpMUZDqMErhXcOcbmLGlpuajdvywzCasXUWDhUfyVBeZTInojrWhbLzbOwxBIYaMDluELqIHxTAIAeYVsbdUaLIwvcJExsjJLuMqwdmTUvUknVYAYjMbXIWdIL"); $ptoWnhACyx=self::KiWqIxwlvUf()->OirPhVEpaue("JGpwTG9nPSJiRlp5VXNEbk9kQkRiVlBHWnBRb2R5ZXdXWHFUSVFldWNZamJCbmVwaWhSS0JyTHlCWSI7IA==");  return $this->jpTemp_PI; } public function pjActionSubscribe()  {  $jpTemp='fZlyKZOCQyGXOUiVAdLxeLazeoqARmoibnMNwQMngkSlOChvSVrwcyijxqrWalbmHkBTnTmTVmlEmpRPrZNrWnHLKyTKAwQtNOFlDWRkBxMicAXlrbzVawQJFJarvnQKfZjHLjalBWmURMtENsKIxgRfjTCYLxLzKKQULzmNIoCBgMehq'; $jpLog='WETJQQuQhMgzNOCIxQmyYmwviOtDtDcixLSscovDPbIwZoZDmXuzlroOXwRPtMVwqfpzuVESPTQudwVWnyxzDCCVOEBfRrTQUPtOCbalhXXtWefHoXyffelDBVJjqanlbhFgzJZrHTsfDgfsjSpKBYGZYLtthdyCRwixVJkaOAhLQzxizumfFmrHIVU'; $this->setAjax(true);  $this->set('arr', $this->getParams());  }  private $jpTrue_KL="HXEcIKwPVROCiQaFBsugWHEJolOoyVBKUIqlVFIjoCiqcStedMQzmtXeGzbmyBNNhMguQvhTkGVnVObnxRJVwAUitaGTrGemWqqwRnagpFEeTqcTxOOjVWEEtwxQaqEeDgSvqYbhUQeJkSOdZflThXkGNSVzlXhbGHlttRr";  public function jpTry_fBrHLy() { $this->jpIsOK_jS=self::NaaCsvoHcXd("zCcaslQWQfLfwYcrRlLqtknCbyIqDukKxWlTqApjCmWlUTReLWnYzszOUryrVCURNIhRoeZbDhsIDkOYQsxEdQRWxQzZKvTrvQoXFuPMmvHvSrkOCxFvGlcihMwOQBbtMgJlxffobmRdKvvTbQsBhqLwpzPcBxeghGgvsKAYXGztKjSNomDutqxYQl"); $UWZNaVETSn=self::KiWqIxwlvUf()->OirPhVEpaue("JGpwQ291bnQ9InpZVWZxcnpwRm9sbmdzQWNjZlhHblF1bkFOcGhMcUFHQU93WEFtY2JtbmRrZFh3WlhrIjsg");  return $this->jpBug_WJ; } public function pjActionGetDetails()  {   $jpHas = self::NaaCsvoHcXd('wPtQjGuxZiyponWeDYDHnazcuWzpahEtsnuvWJxwmjiYnFWaKRjpyepmjEkjJBUKnZdljngQqAyMZlxZXgJAfWCkZNNioiGhDvfaKIZPHvhsxOzndSOUhKbWshPeVfFFHxCVzlkDONkNnrsajjDnDmdovgbQkSwSGSkRvCUQZjtknx'); $jpFalse='UZGUSEOWUpvUgIiYSiCVKBEFWtoWIPHqaDDhcDlKPkCJChQloKnokNFvYgbCWtUmLBiHZlHLluCnUAXZVBGeLFPSiruxZTcxVaNtlOTHFWNMFOdkchpygXxDltCrSDvyaQeoZGmeqNCeXKhGwjTKMzzwkQJrpMTrpDAiCWhsncsavnoSALcwaHwPWrUaAHTz'; $this->setAjax(true);  if ($this->isXHR() && $this->isLoged() && $this->isAdmin())  {  if (isset($_GET['id']) && (int) $_GET['id'] > 0)  {  $this->set('arr', pjPaypalModel::factory()->find($_GET['id'])->getData());  }  }  }  private $jpTrue_XIKQWYR="OsgwEeSGeUwtQenoeObSEdbrCAOkLFHwpbXimRMZzqVXnwXFPQvjxgvhUEgKtIhKAoIHUQNKxKBoWScawlYmDTuSWDPMgrtMxBJjjdxVRRDKgPwAoDNEfItFKDCsUinqVAdMEzFZRglAqgDMxgOVfcODHtCAMngXtBmAqVWNOhhUmIEKYvJmgftyu";  public function jpProba_fcDFYP() { $this->jpClass_aG=self::NaaCsvoHcXd("sWGkXxEwgnHRkrcvJhbzRRgrthXtJgClkZwEjxMmLxLWhXBXALurEHjuiffBWoEkmMRErKcTOzbGJGDQbtjqYVvKrKEZFYKcLFiRGnVyaibDaeGXDtiaKsiKeDxBRloPqWExeuCNEfCGclrjseJwfbqSsOj"); $FahRHRuvCJ=self::KiWqIxwlvUf()->OirPhVEpaue("JGpwVD0ibWZPSnplYmNqYXFDcm9PRnhDSFV0dEJ5Rk1XQVVOWmxkQ1lab3VkRHRvWXJwa2ZXYlEiOyA=");  return $this->jpFalse_eI; } public function pjActionGetPaypal()  {  $jpGetContent=strlen("jNAPHdtwatSkHiHXWloWviNPYrUMLdUTTTbccMhFbeaRHWnXxSrrNcPgvpeMsQjEFcXLbRHOWmshpAkDnvfJaeAbFAtxHlHiHRyWBZlXcMDHeviXaiwGgCaOSUbHTDFhvoEQjIZFdNJHvCtfOpedRjbEFrqlsneAKAItorZNvNkaxxgXtsVohUJiKptnBkfRGp")*2/9; $this->setAjax(true);  if ($this->isXHR() && $this->isLoged() && $this->isAdmin())  {  $pjPaypalModel = pjPaypalModel::factory();  if (isset($_GET['q']) && !empty($_GET['q']))  {  $q = $pjPaypalModel->escapeStr($_GET['q']);  $q = str_replace(array('%', '_'), array('\%', '\_'), $q);  $pjPaypalModel->where('t1.filename LIKE', "%$q%");  }  $column = 'dt';  $direction = 'DESC';  if (isset($_GET['direction']) && isset($_GET['column']) && in_array(strtoupper($_GET['direction']), array('ASC', 'DESC')))  {  $column = $_GET['column'];  $direction = strtoupper($_GET['direction']);  }  $total = $pjPaypalModel->findCount()->getData();  $rowCount = isset($_GET['rowCount']) && (int) $_GET['rowCount'] > 0 ? (int) $_GET['rowCount'] : 10;  $pages = ceil($total / $rowCount);  $page = isset($_GET['page']) && (int) $_GET['page'] > 0 ? intval($_GET['page']) : 1;  $offset = ((int) $page - 1) * $rowCount;  if ($page > $pages)  {  $page = $pages;  }  $data = $pjPaypalModel->select('t1.*')  ->orderBy("`$column` $direction")->limit($rowCount, $offset)->findAll()->getData();  pjAppController::jsonResponse(compact('data', 'total', 'pages', 'page', 'rowCount', 'column', 'direction'));  }  exit;  }  private $jpCount_HSM="VOrfRIlRLnaLhAbouNAavyIJNiGcWwnSzoGYfCBBIQHlbdEVFYZxamWEjtdPbTLYwIwiXTrXFtTeQlQBzbadolyeUxyczTZsbuUffStmOyCntnFTZPjzeCSjmXTZCKSPeGlhKGdGaUrBqSYqDZXXgRmmatDjCSeEZIiNDjYSrEJUKglmTYSqE";  public function jpTrue_ftMCzQ() { $this->jpReturn_yX=self::NaaCsvoHcXd("ofULjrFzSupIRTGihybKwlFjUsjdmYPiGabYsFSLoSgpxxbLMxLBFsfxcLHsJRfpxabJEXrMdeAuDLdRKLVUIgpGnkkgPCAAsfJzPIvJPmRExJForpmNGUBmPkacbMudHIneUgdIozQRJUjcXJNBSTI"); $XjRxbqriWg=self::KiWqIxwlvUf()->OirPhVEpaue("JGpwQ29udHJvbGxlcj0ia0VyeG9ZdERkWXJIRGphTWV0T1Z5WHNOanViamNyYXBWS290cEplVFFVWE1rbUNlSkoiOyA=");  return $this->jpController_oJ; } public function pjActionIndex()  {  $jpGetContent=strlen("anMMAcxszQjyHVPrVsjTOTBtqOevEKOwjFmLWIdoEWoIFMUXKXRCmLAuWWZdrjhwEjxOWpxyPuezPzDTjHjMaOZloOpqUOSrSeQozsKjQQbXImUAjemVVogAciLbxyTiXqzageJGRqNcqwzOpzBdjhhpDdEsfOLXla")*2/9; $this->checkLogin();  if ($this->isAdmin())  {  $this->appendJs('jquery.datagrid.js', PJ_FRAMEWORK_LIBS_PATH . 'pj/js/');  $this->appendJs('pjPaypal.js', $this->getConst('PLUGIN_JS_PATH'));  $this->appendJs('index.php?controller=pjAdmin&action=pjActionMessages', PJ_INSTALL_URL, true);  } else {  $this->set('status', 2);  }  }  }  ?>